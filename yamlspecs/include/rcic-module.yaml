## This file defines generic build/install targets for most 
## module files generated by gen-definitions.py in the yaml2rpm package
## Any definition can be overwritten
## Usual use is !include /opt/rcic/include/rcic-module.yaml
## If multiple yaml fiels are included this one must be the last
## See examples for common overrides.
##
## (C) 2018-2019 UC Regents
## Research Cyberinfrastructure Center, UC Irvine
## Author: Philip M. Papadopoulos
---
no_src_dir: True
envmodule: True
src_tarball: none
foundation: ""
category: ""
pkgname: "{{foundation}}{{name}}_{{version}}-module"
shortname: "{{name}}"
build:
  configure: echo 
  pkgmake: echo 
install:
   makeinstall: echo 
   installextra:
files:
  -  "{{mod_defaults.category_path}}"
requires:
  - "{{foundation}}{{name}}_{{version}}"
  - rcic-module-support
rpm:
  extras: ""

module:
  name: "{{version}}"
  path: "{{mod_defaults.path}}"
  loadname: "{{name}}/{{module.name}}"
  lib: lib
  setenv:
     - "{{mod_defaults.setenv}}"
  prepend_path:
     - "{{mod_defaults.prepend_path}}"
  logger: exec /bin/logger -p local6.notice - t module-hpc $env(USER) {{name}}/{{version}}

mod_defaults:
  category_path: "{{pkg_defaults.RCICmpath}}/{{category}}"
  path: "{{pkg_defaults.RCICmpath}}/{{category}}/{{name}}"
  setenv:  
    - "{{shortname}}__PREFIX {{root}}"
    - "{{shortname}}__CPPFLAGS -I{{root}}/include"
    - "{{shortname}}__LDFLAGS \"-L{{root}}/{{module.lib}} -Wl,-rpath,{{root}}/{{module.lib}}\""
  flagspath:
    - -d " " CPPFLAGS $env({{shortname}}__CPPFLAGS)
    - -d " " LDFLAGS  $env({{shortname}}__LDFLAGS)
  prepend_path:
    - PATH {{root}}/bin
    - MANPATH {{root}}/share/man
    - LD_LIBRARY_PATH {{root}}/{{module.lib}}
    - PKG_CONFIG_PATH {{root}}/{{module.lib}}/pkgconfig
