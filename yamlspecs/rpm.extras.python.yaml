---
## redefine the __spec_install_post macro to load the correct modules so that 
## remove brp-python-bytecompile  from the definition of os_install_post
## use py_byte_compile to byte-compile python files with correct version of python
## usually integrated in yamlspecs as
##       rpm: !include rpm.extras.python.yaml
extras: | 
  %global __os_install_post %(echo '%{__os_install_post}' | sed -e 's!/usr/lib[^[:space:]]*/brp-python-bytecompile[[:space:]].*$!!g') \
  %define _python_bytecompile_errors_terminate_build 0\n\
  %define __spec_install_post \
  %{?__debug_package:%{__debug_install_post}}\
  module load {{ build.modules }};\
  %{__arch_install_post}\
  %{__os_install_post}\
  %py_byte_compile python %{buildroot} \
  module unload {{ build.modules }}\
  %{nil} 
